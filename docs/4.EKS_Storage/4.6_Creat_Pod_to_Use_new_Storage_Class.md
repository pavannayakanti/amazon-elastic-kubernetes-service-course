# 📦 Create Pod to Use New Storage Class

This step demonstrates how to create a new PersistentVolumeClaim (PVC) that uses the default StorageClass (`ebs-sc`), and deploy a new pod that uses the claim.

---

## 🔧 Step 1: Apply the Configuration

Run the following command to create the PVC and Pod:

```bash
cat <<EOF | kubectl apply -f -
# PVC
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: ebs-pvc-new
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: ebs-sc
  resources:
    requests:
      storage: 10Gi
---
# Re-deploy pod
apiVersion: v1
kind: Pod
metadata:
  name: ebs-pod-new
spec:
  containers:
  - name: app
    image: busybox
    command: [ "sh", "-c", "echo Hello Kubernetes! && sleep 3600" ]
    volumeMounts:
    - mountPath: "/data"
      name: ebs-storage
  volumes:
  - name: ebs-storage
    persistentVolumeClaim:
      claimName: ebs-pvc-new
EOF
```
## ✅ Step 2: Verify PVC and Pod
To verify the PVC:
``` bash
kubectl get pvc ebs-pvc-new
```

Expected output:
``` bash
NAME           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
ebs-pvc-new    Bound    pvc-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx   10Gi       RWO            ebs-
```
To verify the pod:

``` bash
kubectl get pod ebs-pod-new
```
Expected output:
``` bash
NAME           READY   STATUS    RESTARTS   AGE
ebs-pod-new    1/1     Running   0          10s
```
🎯 If the pod and PVC are in Running and Bound state respectively, the dynamic provisioning using ebs-sc StorageClass was successful!

## 🧹 Cleanup: Delete EBS Volume After Lab (Optional)

If you created EBS volumes via a PersistentVolumeClaim (PVC), those volumes may remain even after deleting the pod.

To clean up automatically:

### ✅ Recommended Cleanup Step

If your PVC used a StorageClass like `ebs-sc`, first verify its reclaim policy:

```bash
kubectl get storageclass ebs-sc -o yaml | grep reclaimPolicy
```

If you see:
```yaml
reclaimPolicy: Delete
```

Then simply run:
```bash
kubectl delete pod ebs-pod-new
kubectl delete pvc ebs-pvc-new
```

This will:
- Remove the pod
- Remove the PVC
- Automatically delete the associated EBS volume (e.g., `vol-xxxxxxxxxxxxxxxxx`)

### ❗ If ReclaimPolicy is `Retain`

You'll need to delete the volume manually via AWS Console or CLI:

```bash
aws ec2 delete-volume --volume-id <your-volume-id> --region us-east-1
```

You can find the volume ID by running:
```bash
kubectl get pv
```

This ensures you don’t leave behind any unused EBS volumes that could incur cost.

